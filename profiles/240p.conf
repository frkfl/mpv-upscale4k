[verylowres]
# Applies to 240p/288p/SD mush
profile-cond=height <= 360

# --- SD color / flags (NTSC/PAL era) ---
vf=format:colormatrix=bt.601:primaries=bt.601:colorspace=bt.601:colorlevels=full,\
lavfi="eq=contrast=1.18:saturation=1.10:gamma=1.15"

# Native-res cleanup (stronger than DVD)
vf-append=atadenoise=0a=0:0b=0:1a=8:1b=8:2a=8:2b=8
vf-append=deblock=alpha=4:beta=4

# ========== 1) EARLY UPSCALE (twice x2) to give the signal some “canvas” ==========
glsl-shaders-clr
# Fix chroma first
glsl-shaders-append=~~/shaders-dl/CfL_Prediction_RT.glsl
# x2
glsl-shaders-append=~~/shaders-dl/shaders/KrigBilateral.glsl
glsl-shaders-append=~~/shaders-dl/shaders/FSRCNNX_x2_8-0-4-1.glsl
glsl-shaders-append=~~/shaders-dl/SSimSuperRes_RT.glsl
# x4 total (second pass)
glsl-shaders-append=~~/shaders-dl/shaders/KrigBilateral.glsl
glsl-shaders-append=~~/shaders-dl/shaders/FSRCNNX_x2_8-0-4-1.glsl
glsl-shaders-append=~~/shaders-dl/SSimSuperRes_RT.glsl

# Early anti-ringing to stop “fake edges” from taking root
glsl-shaders-append="~~/shaders/ringing_guard.glsl?strength=0.90&radius=1.0&gamma_in=1.0&gamma_out=1.0"

# ========== 2) ANALOGIZE BOLDLY (pre-collapse) ==========
# Gentle shadow lift so near-black chroma survives
glsl-shaders-append="~~/shaders/lift_shadows.glsl?lift=0.022&pivot=0.10&softness=3.0&gamma_in=1.0&gamma_out=1.0"

# Stronger CRT prepass (no visible mask later after collapse)
glsl-shaders-append="~~/shaders/crt_natural.glsl?scan_amp=0.40&scan_curve=1.18&bloom_strength=0.12&bloom_radius=1.40&mask_strength=0.06&mask_soft=0.65&chroma_preserve=0.92&sat_boost=1.05&black_lift=0.015&gamma_in=1.0&gamma_out=1.0"

# Break blockiness with micro entropy before collapsing
glsl-shaders-append="~~/shaders/micro_entropy_grain.glsl?strength=0.010&chroma=0.2&grain_size=1.3&midtone_bias=0.75&animate=1"
glsl-shaders-append=~~/shaders-dl/noise_static_luma.hook

# ========== 3) SSIM COLLAPSE TO A CLEAN 720p BEDROCK ==========
vf-append=scale=1280:720:flags=ssim
# (no unsharp here—let it collapse cleanly)

# ========== 4) 720p CLEANUP ==========
glsl-shaders-append=~~/shaders-dl/nlmeans_light.glsl
glsl-shaders-append=~~/shaders-dl/hdeband.glsl

# ========== 5) FINAL UPSCALE TO 4K (structure) ==========
glsl-shaders-append=~~/shaders-dl/CfL_Prediction_RT.glsl
glsl-shaders-append=~~/shaders-dl/shaders/KrigBilateral.glsl
glsl-shaders-append=~~/shaders-dl/shaders/FSRCNNX_x2_8-0-4-1.glsl
glsl-shaders-append=~~/shaders-dl/SSimSuperRes_RT.glsl

# ========== 6) EDGE STABILITY + VERY SAFE SHARP ==========
glsl-shaders-append="~~/shaders/smaa.glsl?edge_strength=0.38&corner_strength=0.22"
# Protect speculars even here (sweat/hotspots appear even on SD captures)
glsl-shaders-append="~~/shaders/specular_guard.glsl?knee_start=0.72&knee_strength=0.28&blur_amt=0.10&sat_thresh=0.18&warm_sheen=0.00&gamma_in=1.0&gamma_out=1.0"
# Midtone texture—small dose
glsl-shaders-append="~~/shaders/midtone_detail.glsl?amount=0.20&low=0.12&high=0.65&clamp_amt=0.022&radius=1.0&gamma_in=1.0&gamma_out=1.0"
# Edge-aware sharpen—very conservative (240p hates overshoot)
glsl-shaders-append="~~/shaders/masked_sharpen.glsl?strength=0.28&clamp_amt=0.040&edge_low=0.02&edge_high=0.22&flat_protect=0.90&motion_gate=0.70&gamma_in=1.0&gamma_out=1.0"
# Temporal calm—keeps motion from crawling
glsl-shaders-append="~~/shaders/temporal_sharpen.glsl?strength=0.18&motion_sense=0.82&decay=0.92&radius=1.0&clamp_amt=0.032&thresh=0.022&gamma_in=1.0&gamma_out=1.0"

# Post-sharpen anti-ringing mop-up
glsl-shaders-append="~~/shaders/ringing_guard.glsl?strength=0.80&radius=1.0&gamma_in=1.0&gamma_out=1.0"
glsl-shaders-append=~~/shaders-dl/hdeband.glsl

# ========== 7) TONE / COLOR (gentle for 240p) ==========
glsl-shaders-append=~~/shaders-dl/colorlevel_expand.glsl
glsl-shaders-append="~~/shaders/vibrance_oklab.glsl?vibrance=0.10&skin_protect=0.75&mid_bias=0.15&gamma_in=1.0&gamma_out=1.0"
glsl-shaders-append="~~/shaders/chroma_pop.glsl?amount=0.06&radius=1.0&clamp_c=0.045&gamma_in=1.0&gamma_out=1.0"
# Adaptive skin tamer to avoid “caramel” on lighter browns
glsl-shaders-append="~~/shaders/skin_tone_tamer_adaptive.glsl?base_strength=0.30&max_strength=0.46&hue_center=0.07&hue_width=0.12&L_low=0.45&L_high=0.85&warm_bias=0.60&cool_bias=0.40&shift_limit=0.015"

# ========== 8) FINAL CRT + TEXTURE ==========
# A bit more visible to hide SD origins, but color-preserving
glsl-shaders-append="~~/shaders/crt_natural.glsl?scan_amp=0.24&scan_curve=1.34&bloom_strength=0.06&bloom_radius=1.25&mask_strength=0.20&mask_soft=0.30&chroma_preserve=0.88&sat_boost=1.06&black_lift=0.010&gamma_in=1.0&gamma_out=1.0"
# Temporal blue-noise—small; 240p can’t carry heavy grain
glsl-shaders-append="~~/shaders/temporal_blue_grain.glsl?strength=0.014&chroma=0.5&grain_size=1.2"
